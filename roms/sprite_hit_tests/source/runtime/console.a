

console_pos = $7f0

; Print char A to console
; Preserved: A, X, Y
print_char:
      jsr   wait_vbl    ; wait for safe access
print_char_no_wait:
      pha
      lda   #$20
      sta   $2006
      inc   console_pos
      lda   console_pos
      sta   $2006
      lda   #0          ; restore scroll
      sta   $2005
      sta   $2005
      pla
      sta   $2007
      rts
      .code

; Go to next line
; Preserved: A, X, Y
console_newline:
      pha
      lda   console_pos
      and   #$e0
      clc
      adc   #$21
      sta   console_pos
      pla
      rts
      .code
      
; Initialize console
init_console:
      lda   #$81
      sta   console_pos
      
      jsr   wait_vbl    ; init ppu
      lda   #0
      sta   $2000
      sta   $2001
      
      lda   #$3f        ; load palette
      jsr   set_vpage
      lda   #15         ; bg
      ldx   #48         ; fg
      ldy   #8
pal:  sta   $2007
      stx   $2007
      stx   $2007
      stx   $2007
      dey
      bne   pal
      
      lda   #$02        ; load tiles
      jsr   set_vpage